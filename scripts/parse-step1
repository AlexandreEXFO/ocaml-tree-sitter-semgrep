#! /usr/bin/env bash
#
# Run tree-sitter-generated parser on examples/, producing json output.
#
set -eu -o pipefail

project_root=$(git rev-parse --show-toplevel)

# This is the JavaScript wrapper used to call the parser.
# (see note inside of file about why we need to copy it)
#
cp "$project_root"/scripts/tree-sitter-parser.js .

# Run the parser generated by tree-sitter on sample inputs.
#
# All test input files must have extension .in regardless of their language,
# for simplicity.
# If you want to make the language visible, use e.g. 'hello.c.in'.
#
if [[ -d examples ]]; then
  for input in $(ls examples/*.src || :); do
    output=${input%.src}.json
    ./tree-sitter-parser.js "$input" | ydump > "$output"
  done
fi
